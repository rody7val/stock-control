//- item/index.jade
extends ../layout.jade

block title 
	title Nuevo Producto

block css
	link(href='/css/item/new.css', rel="stylesheet", type="text/css")

block js
	script(src='/js/angular-1.1.5.min.js', type="text/javascript")
	script(src='/js/item/new.js', type="text/javascript")

block content
	div(ng-app='stock-control')
		div(ng-controller="StockController")
			if errors.length
				- var err = errors[0].message
			div(class='#{item.edit ? "head-title-edit" : "head-title"}')
				h1.text-center.light #{item.edit ? 'Editar Producto' : 'Nuevo Producto'}
			.container
				.row
					.col-md-12
						nav#find-bar.navbar.navbar-light.bg-faded
							.col-md-5
							.col-md-7
								//- input search
								input.form-control.form-control-lg(
									type='search'
									placeholder='Filtrar por nombre'
									ng-model='itemSearch' 
								)
				.row
					.col-md-5
						#affix.item-new
							include ./_form.jade
					.col-md-7
						table.table.table-hover.body-form
							thead.thead-inverse
								tr
									th: h4.light Items
									th: h4.light Stock
									th: h4.light $/u
									th: h4.light Código
									th: h4.light Acciones
							tbody
								tr(
									ng-repeat="item in stock.items | filter:itemSearch | orderBy: 'name'"
								)
									//- Items
									td: a.btn.btn-link.btn-sm(href='/item/{{item._id}}') {{item.name}}
									//- Stock
									td(class="{{item.qty === 0 ? 'alert-danger' : 'alert-success'}}") {{item.qty}}
									//- $/u
									td {{item.price}}
									//- Código
									td {{item.code}}
									//- Acciones
									td
										a.left.btn.btn-outline-warning.btn-sm(href='/item/{{item._id}}/edit') Editar
										form(method='post', action='/item/{{item._id}}?_method=delete')
											input.left.btn.btn-outline-danger.btn-sm(
												type='submit'
												value='Borrar'
												onClick='return confirm("Eliminar: {{item.name}}?")'
											)
	//- affix
	script(type="text/javascript").
		$(window).on('scroll', function(event) {
			var scrollValue = $(window).scrollTop();
			console.log(scrollValue)
			if (scrollValue > 155) $('#affix.item-new').addClass('top');
			if (scrollValue < 155) $('#affix.item-new').removeClass('top');
		});